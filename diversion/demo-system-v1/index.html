<!--
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html>
  <head>
    <title>demo-system-v1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="demo-system-v1.js" type="text/javascript"></script>
    <link href='https://fonts.googleapis.com/css?family=Josefin Slab' rel='stylesheet'>
    <style>
        body {
            font-family: 'Josefin Slab';
            font-size: 2vw;
            color: white;
            background-color: black;
        }
        a:link {
          text-decoration: none;
          color: #FF8240;
        }

        a:visited {
          text-decoration: none;
          color: #FF8240;
        }

        a:hover {
          text-decoration: underline;
          color: #DFF180;
        }

        a:active {
          text-decoration: underline;
          color: #DFF180;
        }
        canvas.gl {
          position:fixed;
          z-index:-1;
          top:0;
          left: 0;
          height: 100%;
          width: 100%;
          background-color: black;
        }
        div.footer {
          position: fixed;
          bottom: 0;
          width: 100%;
        }
        div.center-flex {
          display: flex;
          align-items: center;
          justify-content: center;
        }
    </style>
    <script id="shader-fs" type="x-shader/x-fragment">

      precision highp float;

      in vec2 v_texcoord;
      out vec4 fragColor;

      uniform vec2 iResolution;
      uniform float iTime;
      uniform float iSine;

      void mainImage(out vec4, in vec2);
      void main(void) { mainImage(fragColor, v_texcoord * iResolution.xy); }

      // --

      void mainImage(out vec4 fragColor, in vec2 fragCoord) {
          vec2 uv = fragCoord.xy / iResolution.xy;
          vec3 col = vec3(uv.xy, 0.5+0.5*iSine);
#ifdef FIRST
          col = vec3(1.0, 0.0, 0.5+0.5*iSine);
#endif
#ifdef SECOND
          col = vec3(0.5+0.5*sin(iTime), 1.0, 0.5+0.5*iSine);
#endif
          col = pow(col, vec3(1.0/2.2));
          fragColor = vec4(col,1.0);
      }
    </script>

    <script id="shader-vs" type="x-shader/x-vertex">
      precision highp float;

      in vec4 a_position;
      in vec2 a_texcoord;

      out vec2 v_texcoord;

      void main(void) {
          // Some drivers don't like position being written here
          // with the tessellation stages enabled also.
          // Comment next line when Tess.Eval shader is enabled.
          gl_Position = a_position;

          v_texcoord = a_texcoord;
      }
    </script>
    <script type = "text/javascript">
      const allScenes = {
        firstScene  : {
          vs: "shader-vs",
          fs: "shader-fs"
        },
        secondScene : {
          vs: "shader-vs",
          fs: "shader-fs",
          defines:["SECOND"],
          uniforms:["iSine"],
        },
      };

      function onInitComplete() {
      }

      function onSelectScene(gl, iTime) {
        const tm = iTime % 1.0;
        const scene = tm > 0.5 ? allScenes.firstScene : allScenes.secondScene;

        return scene;
      }

      function onSetUniforms(gl, iTime, scene) {
        gl.uniform1f(scene.uniformLocations.iSine, Math.sin(iTime));
      }
    </script>
  </head>

  <body onload="runDemo()">
    <h1>Demo system 1</h1>
    <div class="center-flex">
      <div>
        <canvas id="glcanvas" class="gl">
          Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
        </canvas>
      </div>
    </div>
  </body>
</html>